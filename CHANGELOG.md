# 变更日志

## 版本 1.1.0 (2024年)

### 新增功能

#### 灵活的文件命名系统
- **使用数据列值命名**: 支持使用数据中的特定列值作为文件名
  - 新增 `nameColumn` 参数，指定用于命名的数据列索引
  - 适用于员工编号、订单号等唯一标识符场景
  - 示例：`EMP001.docx`, `ORD202401001.docx`

- **使用基础文件名 + 序号命名**: 支持统一的命名格式
  - 新增 `baseFileName` 参数，指定基础文件名
  - 自动添加序号后缀
  - 示例：`员工报告_1.docx`, `月度总结_2.docx`

- **自定义文件扩展名**: 支持自定义文件扩展名
  - 新增 `fileExtension` 参数
  - 默认为 `.docx`，可自定义为其他格式
  - 示例：`.pdf`, `.doc`

#### 文件名安全处理
- **特殊字符处理**: 自动替换Windows文件系统非法字符
  - 将 `<>:"/\|?*` 等字符替换为下划线 `_`
  - 确保文件名兼容性

- **长度限制**: 文件名长度限制为200字符
- **空值处理**: 空值或无效值使用 "unnamed" 作为文件名
- **错误处理**: 完善的错误处理机制，自动降级到默认命名

### 技术改进

#### ReportRequest 类增强
- 新增 `nameColumn` 字段：用于命名的数据列索引
- 新增 `baseFileName` 字段：基础文件名
- 新增 `fileExtension` 字段：文件扩展名
- 新增默认构造函数，设置默认文件扩展名

#### ReportService 类重构
- 新增 `generateFileName()` 方法：处理文件命名逻辑
- 新增 `sanitizeFileName()` 方法：清理文件名中的非法字符
- 重构 `generateReports()` 方法：集成新的命名逻辑
- 完善的错误处理和边界情况处理

### 文档更新

#### 新增文档
- `API_DESIGN.md`: 详细的API设计文档
- `USAGE_EXAMPLES.md`: 完整的使用示例和最佳实践
- `CHANGELOG.md`: 变更日志（本文档）

#### 更新文档
- `README.txt`: 添加新功能说明和使用指南

### 向后兼容性

- 保持与现有API的完全兼容
- 不指定新参数时，使用原有的默认命名方式
- 现有客户端代码无需修改即可继续使用

### 使用示例

#### 场景1: 使用员工编号命名
```json
{
  "templatePath": "templates/employee_report.docx",
  "data": [["EMP001", "张三", "技术部"], ["EMP002", "李四", "销售部"]],
  "nameColumn": "0"
}
```

#### 场景2: 使用基础文件名命名
```json
{
  "templatePath": "templates/employee_report.docx",
  "data": [["EMP001", "张三", "技术部"], ["EMP002", "李四", "销售部"]],
  "baseFileName": "员工月度报告"
}
```

#### 场景3: 自定义文件扩展名
```json
{
  "templatePath": "templates/employee_report.docx",
  "data": [["EMP001", "张三", "技术部"]],
  "baseFileName": "员工报告",
  "fileExtension": ".pdf"
}
```

### 优先级规则

1. 如果指定了 `nameColumn`，优先使用数据列值命名
2. 如果未指定 `nameColumn` 但指定了 `baseFileName`，使用基础文件名 + 序号命名
3. 如果都未指定，使用默认的 "report_序号" 命名方式

### 错误处理

- **列索引超出范围**: 自动使用默认命名
- **列索引格式错误**: 自动使用默认命名
- **空值或无效值**: 使用 "unnamed" 作为文件名
- **特殊字符**: 自动替换为下划线

### 性能优化

- 文件名生成逻辑优化，减少不必要的字符串操作
- 错误处理机制优化，提高系统稳定性
- 内存使用优化，减少临时对象创建

### 测试覆盖

- 文件名生成逻辑的完整测试覆盖
- 边界情况和错误情况的测试
- 特殊字符处理的测试
- 向后兼容性测试

### 部署说明

- 无需数据库迁移
- 无需配置文件修改
- 直接替换JAR文件即可
- 支持热部署

### 已知问题

- 无已知问题

### 未来计划

- 支持更复杂的命名模式（如日期+编号）
- 支持文件名模板功能
- 支持批量重命名功能
- 支持文件名预览功能
